DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (12.3ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.4ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f8ee124fb90 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f8ee17a0e00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f8ee1247a08 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f8ee124a280 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f8ee1247918 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f8ee124a0c8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f8ee124a000>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f8ee13eb7d8 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f8ee17a0e00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f8ee1247a08 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f8ee124a280 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f8ee1247918 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f8ee124a0c8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f8ee124a000>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f8ee13ec700 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f8ee17a0e00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f8ee1247a08 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f8ee124a280 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f8ee1247918 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f8ee124a0c8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f8ee124a000>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:40cvlf][#<Thread:0x00007f8ee5ddfc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11fb5b8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f8ee11fb5b8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:40cvlf][#<Thread:0x00007f8ee5ddfc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11fb5b8>] New worker: I'm alive.
[worker-instabug.message.create:1:9hytoc][#<Thread:0x00007f8ee5ddfc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11f8480>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f8ee11f8480>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.chat.create:1:2faw51][#<Thread:0x00007f8ee5ddfc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11f9970>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f8ee11f9970>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:2faw51][#<Thread:0x00007f8ee5ddfc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11f9970>] New worker: I'm alive.
[worker-instabug.message.create:1:magabd][#<Thread:0x00007f8ee5ddfc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11fcfd0>] New worker: subscribing.
[worker-instabug.message.create:1:9hytoc][#<Thread:0x00007f8ee5ddfc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11f8480>] New worker: I'm alive.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f8ee11fcfd0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:magabd][#<Thread:0x00007f8ee5ddfc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11fcfd0>] New worker: I'm alive.
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in <main> at /app/lib/tasks/whenever_update_application_count.rake:13)
  [1m[35mSQL (2.4ms)[0m  [1m[35mSET SQL_SAFE_UPDATES=0;[0m
  ↳ lib/tasks/whenever_update_application_count.rake:13:in `block in <main>'
  [1m[35m (2.5ms)[0m  [1m[33m    UPDATE applications 
    JOIN (SELECT chats.application_id as app_id,count(chats.id) as chat_cnt FROM chats  
    group by chats.application_id) as w on w.app_id=applications.id set applications.chats_count=w.chat_cnt
[0m
  ↳ lib/tasks/whenever_update_application_count.rake:14:in `block in <main>'
  [1m[35m (0.5ms)[0m  [1m[33m    UPDATE chats  
    JOIN (SELECT messages.chat_id as chat_id,count(messages.id) as message_cnt FROM messages 
     group by messages.chat_id) as w on w.chat_id=chats.id set chats.messages_count=w.message_cnt
[0m
  ↳ lib/tasks/whenever_update_application_count.rake:15:in `block in <main>'
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:00:25 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first-app"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (2.7ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('5dac8751-f2f5-4070-ae71-79559dabf611', 'first-app', '2022-11-07 08:00:26.752662', '2022-11-07 08:00:26.752662')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 421ms (Views: 1.0ms | ActiveRecord: 8.3ms | Allocations: 13537)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started GET "/applications/5dac8751-f2f5-4070-ae71-79559dabf611" for 172.22.0.1 at 2022-11-07 08:00:37 +0000
Processing by ApplicationsController#show as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApplication Load (0.9ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/applications_controller.rb:45:in `set_application'
Completed 200 OK in 13ms (Views: 0.4ms | ActiveRecord: 0.9ms | Allocations: 1610)


Started PATCH "/applications/5dac8751-f2f5-4070-ae71-79559dabf611" for 172.22.0.1 at 2022-11-07 08:00:48 +0000
Processing by ApplicationsController#update as */*
  Parameters: {"name"=>"updated_name", "app_token"=>"[FILTERED]"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/applications_controller.rb:45:in `set_application'
[31mUnpermitted parameter: :app_token. Context: { controller: ApplicationsController, action: update, request: #<ActionDispatch::Request:0x00007f2e67d82b50>, params: {"name"=>"updated_name", "controller"=>"applications", "action"=>"update", "app_token"=>"[FILTERED]"} }[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:34:in `update'
  [1m[36mApplication Update (2.8ms)[0m  [1m[33mUPDATE `applications` SET `applications`.`name` = 'updated_name', `applications`.`updated_at` = '2022-11-07 08:00:48.456764' WHERE `applications`.`id` = 1[0m
  ↳ app/controllers/applications_controller.rb:34:in `update'
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:34:in `update'
Completed 204 No Content in 19ms (ActiveRecord: 7.3ms | Allocations: 2807)


Started GET "/applications/5dac8751-f2f5-4070-ae71-79559dabf611" for 172.22.0.1 at 2022-11-07 08:00:56 +0000
Processing by ApplicationsController#show as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/applications_controller.rb:45:in `set_application'
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.5ms | Allocations: 652)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started GET "/applications/5dac8751-f2f5-4070-ae71-79559dabf611/chats" for 172.22.0.1 at 2022-11-07 08:01:06 +0000
Processing by ApplicationsController#index as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApplication Load (0.7ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/applications_controller.rb:45:in `set_application'
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.`number`, `chats`.`name`, `chats`.`created_at`, `chats`.`updated_at`, `chats`.`messages_count` FROM `chats` WHERE `chats`.`application_id` = 1[0m
  ↳ app/controllers/concerns/response.rb:3:in `json_response'
Completed 200 OK in 437ms (Views: 3.9ms | ActiveRecord: 2.3ms | Allocations: 13176)


Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:01:18 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first_chat_first_app"}
  [1m[36mApplication Load (1.0ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e95bc5050 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e95bc8f98 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e95bc8f98 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 139ms (Views: 0.7ms | ActiveRecord: 1.8ms | Allocations: 7131)


[worker-instabug.chat.create:1:40cvlf][#<Thread:0x00007f8ee11d3ea0 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11fb5b8>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":1,\"created_at\":null,\"updated_at\":null,\"name\":\"first_chat_first_app\"}"
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (1.0ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 1, '2022-11-07 08:01:19.179522', '2022-11-07 08:01:19.179522', 'first_chat_first_app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Heartbeat: running threads [9]
Heartbeat: running threads [11]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1" for 172.22.0.1 at 2022-11-07 08:01:30 +0000
Processing by ChatsController#show as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
Completed 200 OK in 9ms (Views: 0.3ms | ActiveRecord: 1.6ms | Allocations: 1617)


Started PATCH "/chats/1" for 172.22.0.1 at 2022-11-07 08:01:45 +0000
Processing by ChatsController#update as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"test name", "number"=>"1"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameter: :number. Context: { controller: ChatsController, action: update, request: #<ActionDispatch::Request:0x00007f2e95a7bb90>, params: {"app_token"=>"[FILTERED]", "name"=>"test name", "controller"=>"chats", "action"=>"update", "number"=>"1"} }[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/chats_controller.rb:47:in `update'
  [1m[36mChat Update (2.3ms)[0m  [1m[33mUPDATE `chats` SET `chats`.`updated_at` = '2022-11-07 08:01:45.842408', `chats`.`name` = 'test name' WHERE `chats`.`id` = 1[0m
  ↳ app/controllers/chats_controller.rb:47:in `update'
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/chats_controller.rb:47:in `update'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Completed 204 No Content in 226ms (ActiveRecord: 8.2ms | Allocations: 8810)


Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1" for 172.22.0.1 at 2022-11-07 08:01:50 +0000
Processing by ChatsController#show as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
Completed 200 OK in 11ms (Views: 0.6ms | ActiveRecord: 1.7ms | Allocations: 1466)


Started GET "/applications/5dac8751-f2f5-4070-ae71-79559dabf611/chats" for 172.22.0.1 at 2022-11-07 08:01:55 +0000
Processing by ApplicationsController#index as */*
  Parameters: {"app_token"=>"[FILTERED]"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/applications_controller.rb:45:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.`number`, `chats`.`name`, `chats`.`created_at`, `chats`.`updated_at`, `chats`.`messages_count` FROM `chats` WHERE `chats`.`application_id` = 1[0m
  ↳ app/controllers/concerns/response.rb:3:in `json_response'
Completed 200 OK in 8ms (Views: 3.4ms | ActiveRecord: 1.2ms | Allocations: 1503)


Heartbeat: running threads [11]
Heartbeat: running threads [9]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/messages" for 172.22.0.1 at 2022-11-07 08:02:09 +0000
Processing by ChatsController#index as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1"}
  [1m[36mApplication Load (0.7ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
  [1m[36mMessage Load (6.7ms)[0m  [1m[34mSELECT `messages`.`number`, `messages`.`body`, `messages`.`created_at`, `messages`.`updated_at` FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/controllers/concerns/response.rb:3:in `json_response'
Completed 200 OK in 21ms (Views: 3.3ms | ActiveRecord: 8.2ms | Allocations: 2213)


Sending a heartbeat, last activity time: 2022-11-07 08:01:18 +0000, interval (s): 29
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:02:19 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"first_message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e9660c518 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e94092738 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e94092738 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 168ms (Views: 0.2ms | ActiveRecord: 1.8ms | Allocations: 7130)


[worker-instabug.message.create:1:9hytoc][#<Thread:0x00007f8ee11ec388 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11f8480>] Working off: "{\"id\":null,\"number\":1,\"body\":\"first_message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'first_message', 1, '2022-11-07 08:02:19.951175', '2022-11-07 08:02:19.951175')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [9]
Heartbeat: running threads [12]
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:02:44 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"second message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 3
Session#handle_frame on 3: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e94080c90 @channel_id="">
Session#handle_frame on 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e94086320 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e94086320 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 16ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1963)


[worker-instabug.message.create:1:magabd][#<Thread:0x00007f8ee11f3688 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11fcfd0>] Working off: "{\"id\":null,\"number\":2,\"body\":\"second message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (2, 'second message', 1, '2022-11-07 08:02:44.504949', '2022-11-07 08:02:44.504949')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:02:50 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"third message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 4
Session#handle_frame on 4: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e9401cc40 @channel_id="">
Session#handle_frame on 4: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e940237c0 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 4: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e940237c0 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 15ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1701)


[worker-instabug.message.create:1:9hytoc][#<Thread:0x00007f8ee11ec388 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11f8480>] Working off: "{\"id\":null,\"number\":3,\"body\":\"third message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (1.0ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (3, 'third message', 1, '2022-11-07 08:02:51.094636', '2022-11-07 08:02:51.094636')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [13]
Heartbeat: running threads [11]
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:02:57 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"forth message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 5
Session#handle_frame on 5: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e67df0358 @channel_id="">
Session#handle_frame on 5: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e67df62a8 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 5: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e67df62a8 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 14ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1699)


[worker-instabug.message.create:1:magabd][#<Thread:0x00007f8ee11f3688 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f8ee11fcfd0>] Working off: "{\"id\":null,\"number\":4,\"body\":\"forth message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (1.3ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (4, 'forth message', 1, '2022-11-07 08:02:57.478128', '2022-11-07 08:02:57.478128')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Started GET "/messages/5dac8751-f2f5-4070-ae71-79559dabf611/1/1" for 172.22.0.1 at 2022-11-07 08:03:17 +0000
Processing by MessagesController#show as */*
  Parameters: {"app_token"=>"[FILTERED]", "chat_number"=>"1", "number"=>"1"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1 AND `messages`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:51:in `set_message'
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 1.8ms | Allocations: 1713)


Heartbeat: running threads [12]
Heartbeat: running threads [13]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/message" for 172.22.0.1 at 2022-11-07 08:03:42 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67dbbd60>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67dbbd60>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
Completed 200 OK in 1051ms (Views: 1042.1ms | ActiveRecord: 1.2ms | Allocations: 2589)


Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/messages" for 172.22.0.1 at 2022-11-07 08:03:58 +0000
Processing by ChatsController#index as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT `messages`.`number`, `messages`.`body`, `messages`.`created_at`, `messages`.`updated_at` FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/controllers/concerns/response.rb:3:in `json_response'
Completed 200 OK in 13ms (Views: 4.3ms | ActiveRecord: 2.1ms | Allocations: 2464)


Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/first_message" for 172.22.0.1 at 2022-11-07 08:04:13 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d60898>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d60898>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"} }[0m
Completed 200 OK in 23ms (Views: 13.4ms | ActiveRecord: 1.3ms | Allocations: 2380)


Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [13]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/first_message" for 172.22.0.1 at 2022-11-07 08:06:07 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"}
  [1m[36mApplication Load (0.4ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d249b0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d249b0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first_message"} }[0m
Completed 200 OK in 19ms (Views: 9.7ms | ActiveRecord: 1.0ms | Allocations: 2381)


Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/%20" for 172.22.0.1 at 2022-11-07 08:06:12 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>" "}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d0b6b8>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>" "} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e67d0b6b8>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>" "} }[0m
Completed 200 OK in 37ms (Views: 15.6ms | ActiveRecord: 1.6ms | Allocations: 2382)


Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/second%20message" for 172.22.0.1 at 2022-11-07 08:06:20 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e9403e9d0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e9403e9d0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
Completed 200 OK in 38ms (Views: 19.0ms | ActiveRecord: 1.3ms | Allocations: 2379)


Heartbeat: running threads [12]
Heartbeat: running threads [13]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/second%20message" for 172.22.0.1 at 2022-11-07 08:06:45 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e95ac66e0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e95ac66e0>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
Completed 200 OK in 60ms (Views: 12.1ms | ActiveRecord: 1.3ms | Allocations: 2388)


Heartbeat: running threads [12]
Heartbeat: running threads [13]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/second%20message" for 172.22.0.1 at 2022-11-07 08:09:31 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e96e7da08>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f2e96e7da08>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"second message"} }[0m
Completed 200 OK in 20ms (Views: 11.0ms | ActiveRecord: 1.2ms | Allocations: 2380)


Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Heartbeat: running threads [13]
Heartbeat: running threads [12]
Sending a heartbeat, last activity time: 2022-11-07 08:02:57 +0000, interval (s): 29
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:10:48 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"second_chat_first_app"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Allocated channel id: 6
Session#handle_frame on 6: #<AMQ::Protocol::Channel::OpenOk:0x00007f2e95bddc40 @channel_id="">
Session#handle_frame on 6: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e95be1ef8 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 6: #<AMQ::Protocol::Queue::DeclareOk:0x00007f2e95be1ef8 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 14ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 1427)


[worker-instabug.chat.create:1:2faw51][#<Thread:0x00007f8ee11d2c80 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f8ee11f9970>] Working off: "{\"id\":null,\"number\":2,\"messages_count\":null,\"application_id\":1,\"created_at\":null,\"updated_at\":null,\"name\":\"second_chat_first_app\"}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (2, 1, '2022-11-07 08:10:48.566226', '2022-11-07 08:10:48.566226', 'second_chat_first_app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 2[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Heartbeat: running threads [13]
Heartbeat: running threads [13]
Heartbeat: running threads [13]
Heartbeat: running threads [13]
Sending a heartbeat, last activity time: 2022-11-07 08:10:48 +0000, interval (s): 29
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (1.0ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f4de43df520 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f4de493ce00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f4de43ebed8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f4de43ee750 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f4de43ebde8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f4de43ee598 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f4de43ee4d0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f4de43ee7a0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f4de493ce00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f4de43ebed8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f4de43ee750 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f4de43ebde8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f4de43ee598 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f4de43ee4d0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f4de43f4d08 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f4de493ce00>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f4de43ebed8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f4de43ee750 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f4de43ebde8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f4de43ee598 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f4de43ee4d0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:4hu22f][#<Thread:0x00007f4de8f7bc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f4de458c9b8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f4de458c9b8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:4hu22f][#<Thread:0x00007f4de8f7bc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f4de458c9b8>] New worker: I'm alive.
[worker-instabug.message.create:1:v3gk24][#<Thread:0x00007f4de8f7bc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4596cb0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f4de4596cb0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:v3gk24][#<Thread:0x00007f4de8f7bc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4596cb0>] New worker: I'm alive.
[worker-instabug.chat.create:1:42s1fs][#<Thread:0x00007f4de8f7bc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f4de45916e8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f4de45916e8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:42s1fs][#<Thread:0x00007f4de8f7bc90 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f4de45916e8>] New worker: I'm alive.
[worker-instabug.message.create:1:v2u00][#<Thread:0x00007f4de8f7bc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4594050>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f4de4594050>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:v2u00][#<Thread:0x00007f4de8f7bc90 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4594050>] New worker: I'm alive.
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:13:43 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.7ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('fd2f3abe-486a-4b3f-a5f1-e9cd891082fb', 'first app', '2022-11-07 08:13:44.256528', '2022-11-07 08:13:44.256528')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (3.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 120ms (Views: 0.4ms | ActiveRecord: 6.7ms | Allocations: 12143)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:14:07 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (0.9ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'fd2f3abe-486a-4b3f-a5f1-e9cd891082fb' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007fe343670cb8 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe34326a9c0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe34326a9c0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 232ms (Views: 0.4ms | ActiveRecord: 2.3ms | Allocations: 15705)


[worker-instabug.chat.create:1:4hu22f][#<Thread:0x00007f4de4363010 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f4de458c9b8>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":2,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.7ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 2, '2022-11-07 08:14:07.963473', '2022-11-07 08:14:07.963473', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 3[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Heartbeat: running threads [11]
Heartbeat: running threads [9]
Heartbeat: running threads [11]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:14:07 +0000, interval (s): 29
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:15:06 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"forth message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'fd2f3abe-486a-4b3f-a5f1-e9cd891082fb' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007fe342ff3408 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe342ff1d88 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe342ff1d88 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 138ms (Views: 0.3ms | ActiveRecord: 3.7ms | Allocations: 8368)


[worker-instabug.message.create:1:v3gk24][#<Thread:0x00007f4de4384c10 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4596cb0>] Working off: "{\"id\":null,\"number\":1,\"body\":\"forth message\",\"chat_id\":3,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'forth message', 3, '2022-11-07 08:15:07.440115', '2022-11-07 08:15:07.440115')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:15:07 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:15:07 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:15:07 +0000, interval (s): 29
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:17:13 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"forth message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'fd2f3abe-486a-4b3f-a5f1-e9cd891082fb' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 3
Session#handle_frame on 3: #<AMQ::Protocol::Channel::OpenOk:0x00007fe361f73360 @channel_id="">
Session#handle_frame on 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe361f71268 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007fe361f71268 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 217ms (Views: 0.4ms | ActiveRecord: 4.6ms | Allocations: 13237)


[worker-instabug.message.create:1:v2u00][#<Thread:0x00007f4de438b6c8 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f4de4594050>] Working off: "{\"id\":null,\"number\":2,\"body\":\"forth message\",\"chat_id\":3,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (2, 'forth message', 3, '2022-11-07 08:17:14.512628', '2022-11-07 08:17:14.512628')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:17:14 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:17:14 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:17:14 +0000, interval (s): 29
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe1c324c7d0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe1c37a0da8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe1c3250420 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe1c3252c70 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe1c3250330 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe1c3252ab8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe1c32529f0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe1c32672b0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe1c37a0da8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe1c3250420 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe1c3252c70 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe1c3250330 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe1c3252ab8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe1c32529f0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe1c33f1ae0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe1c37a0da8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe1c3250420 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe1c3252c70 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe1c3250330 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe1c3252ab8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe1c32529f0>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:uux46d][#<Thread:0x00007fe1c7ddfc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe1c31ff9d0>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe1c31ff9d0>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:uux46d][#<Thread:0x00007fe1c7ddfc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe1c31ff9d0>] New worker: I'm alive.
[worker-instabug.message.create:1:mi1pex][#<Thread:0x00007fe1c7ddfc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe1c31fcb90>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe1c31fcb90>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:mi1pex][#<Thread:0x00007fe1c7ddfc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe1c31fcb90>] New worker: I'm alive.
[worker-instabug.chat.create:1:9kfeya][#<Thread:0x00007fe1c7ddfc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe1c31fecd8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe1c31fecd8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:9kfeya][#<Thread:0x00007fe1c7ddfc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe1c31fecd8>] New worker: I'm alive.
[worker-instabug.message.create:1:8j220d][#<Thread:0x00007fe1c7ddfc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe1c3203198>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe1c3203198>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:8j220d][#<Thread:0x00007fe1c7ddfc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe1c3203198>] New worker: I'm alive.
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:23:55 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.6ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('bce7415c-4ffa-4efe-b14a-9fd79cc0e6dc', 'first app', '2022-11-07 08:23:56.785817', '2022-11-07 08:23:56.785817')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 122ms (Views: 0.7ms | ActiveRecord: 4.9ms | Allocations: 12226)


Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:24:09 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'bce7415c-4ffa-4efe-b14a-9fd79cc0e6dc' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007fa63b11f2b8 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fa63b11cfe0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fa63b11cfe0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 209ms (Views: 0.3ms | ActiveRecord: 2.0ms | Allocations: 15705)


[worker-instabug.chat.create:1:uux46d][#<Thread:0x00007fe1c31d05b8 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe1c31ff9d0>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":3,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 3, '2022-11-07 08:24:10.482436', '2022-11-07 08:24:10.482436', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 4[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Heartbeat: running threads [11]
Heartbeat: running threads [9]
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:24:24 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"forth message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.9ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'bce7415c-4ffa-4efe-b14a-9fd79cc0e6dc' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007fa63aeb3740 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fa63aeb1f08 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fa63aeb1f08 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 102ms (Views: 0.5ms | ActiveRecord: 2.3ms | Allocations: 8367)


[worker-instabug.message.create:1:mi1pex][#<Thread:0x00007fe1c3172a58 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe1c31fcb90>] Working off: "{\"id\":null,\"number\":1,\"body\":\"forth message\",\"chat_id\":4,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'forth message', 4, '2022-11-07 08:24:25.080089', '2022-11-07 08:24:25.080089')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (5.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:24:25 +0000, interval (s): 29
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe6ed12a468 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe6ed670e40>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe6ed120558 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe6ed122da8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe6ed120468 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe6ed122bf0 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe6ed122b28>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe6ed2c0ca0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe6ed670e40>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe6ed120558 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe6ed122da8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe6ed120468 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe6ed122bf0 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe6ed122b28>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fe6ed0c68c8 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fe6ed670e40>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fe6ed120558 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fe6ed122da8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fe6ed120468 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fe6ed122bf0 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fe6ed122b28>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:9jd4hf][#<Thread:0x00007fe6f1cafc58 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe6ed0d2b00>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe6ed0d2b00>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:9jd4hf][#<Thread:0x00007fe6f1cafc58 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe6ed0d2b00>] New worker: I'm alive.
[worker-instabug.message.create:1:gn1500][#<Thread:0x00007fe6f1cafc58 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe6ed0d78d0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe6ed0d78d0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:gn1500][#<Thread:0x00007fe6f1cafc58 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe6ed0d78d0>] New worker: I'm alive.
[worker-instabug.chat.create:1:op9b11][#<Thread:0x00007fe6f1cafc58 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe6ed0d1250>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe6ed0d1250>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:op9b11][#<Thread:0x00007fe6f1cafc58 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe6ed0d1250>] New worker: I'm alive.
[worker-instabug.message.create:1:fzh03w][#<Thread:0x00007fe6f1cafc58 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe6ed0d54e0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fe6ed0d54e0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:fzh03w][#<Thread:0x00007fe6f1cafc58 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe6ed0d54e0>] New worker: I'm alive.
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:31:55 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.6ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('87b5d92a-82b2-4cfe-8598-2c1cd1f59a48', 'first app', '2022-11-07 08:31:56.738023', '2022-11-07 08:31:56.738023')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 127ms (Views: 0.5ms | ActiveRecord: 6.9ms | Allocations: 12221)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:32:06 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '87b5d92a-82b2-4cfe-8598-2c1cd1f59a48' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007ffaf6f08040 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007ffaf6b02180 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007ffaf6b02180 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 228ms (Views: 0.2ms | ActiveRecord: 2.0ms | Allocations: 15707)


[worker-instabug.chat.create:1:9jd4hf][#<Thread:0x00007fe6ed0a05b0 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fe6ed0d2b00>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":4,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 4, '2022-11-07 08:32:07.534028', '2022-11-07 08:32:07.534028', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (1.0ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 5[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:32:20 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"first message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '87b5d92a-82b2-4cfe-8598-2c1cd1f59a48' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007ffaf688d260 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007ffaf688ba00 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007ffaf688ba00 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 99ms (Views: 0.3ms | ActiveRecord: 2.1ms | Allocations: 8369)


[worker-instabug.message.create:1:gn1500][#<Thread:0x00007fe6ed038050 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fe6ed0d78d0>] Working off: "{\"id\":null,\"number\":1,\"body\":\"first message\",\"chat_id\":5,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.7ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'first message', 5, '2022-11-07 08:32:21.084084', '2022-11-07 08:32:21.084084')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:32:21 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:32:21 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:32:21 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.5ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f3d43a1ace8 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f3d43f68d80>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f3d43a0fb68 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f3d43a123e0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f3d43a0fa78 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f3d43a12228 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f3d43a12160>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f3d43bb1520 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f3d43f68d80>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f3d43a0fb68 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f3d43a123e0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f3d43a0fa78 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f3d43a12228 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f3d43a12160>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f3d43bb9f18 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f3d43f68d80>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f3d43a0fb68 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f3d43a123e0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f3d43a0fa78 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f3d43a12228 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f3d43a12160>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:zyo7y2][#<Thread:0x00007f3d485a7c60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f3d439c2340>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f3d439c2340>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:zyo7y2][#<Thread:0x00007f3d485a7c60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f3d439c2340>] New worker: I'm alive.
[worker-instabug.message.create:1:a5dxyw][#<Thread:0x00007f3d485a7c60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f3d439c7160>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f3d439c7160>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:a5dxyw][#<Thread:0x00007f3d485a7c60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f3d439c7160>] New worker: I'm alive.
[worker-instabug.chat.create:1:iuhc5z][#<Thread:0x00007f3d485a7c60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f3d439c1490>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f3d439c1490>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:iuhc5z][#<Thread:0x00007f3d485a7c60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f3d439c1490>] New worker: I'm alive.
[worker-instabug.message.create:1:ed4urq][#<Thread:0x00007f3d485a7c60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f3d439cb7b0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f3d439cb7b0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:ed4urq][#<Thread:0x00007f3d485a7c60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f3d439cb7b0>] New worker: I'm alive.
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6dba439480 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6dba7f0d58>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6dba297b40 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6dba29a3b8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6dba297a50 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6dba29a200 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6dba29a138>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6dba44c3f0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6dba7f0d58>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6dba297b40 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6dba29a3b8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6dba297a50 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6dba29a200 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6dba29a138>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6dba24a1b0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6dba7f0d58>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6dba297b40 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6dba29a3b8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6dba297a50 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6dba29a200 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6dba29a138>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:korvn3][#<Thread:0x00007f6dbee2fc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6dba25bed8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6dba25bed8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:korvn3][#<Thread:0x00007f6dbee2fc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6dba25bed8>] New worker: I'm alive.
[worker-instabug.message.create:1:dovgsw][#<Thread:0x00007f6dbee2fc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6dba2590c0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6dba2590c0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:dovgsw][#<Thread:0x00007f6dbee2fc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6dba2590c0>] New worker: I'm alive.
[worker-instabug.chat.create:1:kr4ggr][#<Thread:0x00007f6dbee2fc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6dba25aa38>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6dba25aa38>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:kr4ggr][#<Thread:0x00007f6dbee2fc60 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6dba25aa38>] New worker: I'm alive.
[worker-instabug.message.create:1:abu26y][#<Thread:0x00007f6dbee2fc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6dba25ffd8>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6dba25ffd8>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:abu26y][#<Thread:0x00007f6dbee2fc60 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6dba25ffd8>] New worker: I'm alive.
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:42:36 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.7ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('5806bb59-0f60-457e-807f-2fd06a1558f7', 'first app', '2022-11-07 08:42:37.909561', '2022-11-07 08:42:37.909561')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (3.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 119ms (Views: 0.4ms | ActiveRecord: 7.4ms | Allocations: 12221)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:43:03 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (0.7ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5806bb59-0f60-457e-807f-2fd06a1558f7' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007f4bea90bdd8 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f4bea90a000 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f4bea90a000 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 282ms (Views: 0.3ms | ActiveRecord: 2.7ms | Allocations: 15707)


[worker-instabug.chat.create:1:korvn3][#<Thread:0x00007f6dba237b78 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6dba25bed8>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":5,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 5, '2022-11-07 08:43:04.446015', '2022-11-07 08:43:04.446015', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 6[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:43:13 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"first message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = '5806bb59-0f60-457e-807f-2fd06a1558f7' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007f4bea695248 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f4bea6939e8 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f4bea6939e8 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 145ms (Views: 0.4ms | ActiveRecord: 4.1ms | Allocations: 8373)


[worker-instabug.message.create:1:dovgsw][#<Thread:0x00007f6dba1da4f0 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6dba2590c0>] Working off: "{\"id\":null,\"number\":1,\"body\":\"first message\",\"chat_id\":6,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'first message', 6, '2022-11-07 08:43:14.014972', '2022-11-07 08:43:14.014972')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Started GET "/chats/5dac8751-f2f5-4070-ae71-79559dabf611/1/search/message" for 172.22.0.1 at 2022-11-07 08:44:32 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5dac8751-f2f5-4070-ae71-79559dabf611' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c017f0a68>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c017f0a68>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
Completed 200 OK in 35ms (Views: 26.2ms | ActiveRecord: 1.1ms | Allocations: 2953)


Heartbeat: running threads [12]
Heartbeat: running threads [9]
Started GET "/chats/5806bb59-0f60-457e-807f-2fd06a1558f7/1/search/message" for 172.22.0.1 at 2022-11-07 08:44:48 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5806bb59-0f60-457e-807f-2fd06a1558f7' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.6ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 5 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c00ba2270>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c00ba2270>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"message"} }[0m
Completed 200 OK in 21ms (Views: 12.0ms | ActiveRecord: 1.2ms | Allocations: 2381)


Started GET "/chats/5806bb59-0f60-457e-807f-2fd06a1558f7/1/search/first%20message" for 172.22.0.1 at 2022-11-07 08:44:55 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"}
  [1m[36mApplication Load (0.7ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5806bb59-0f60-457e-807f-2fd06a1558f7' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 5 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c00b93888>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f4c00b93888>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"} }[0m
Completed 200 OK in 24ms (Views: 14.0ms | ActiveRecord: 1.5ms | Allocations: 2382)


Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in <main> at /app/lib/tasks/whenever_update_application_count.rake:13)
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET SQL_SAFE_UPDATES=0;[0m
  ↳ lib/tasks/whenever_update_application_count.rake:13:in `block in <main>'
  [1m[35m (6.6ms)[0m  [1m[33m    UPDATE applications 
    JOIN (SELECT chats.application_id as app_id,count(chats.id) as chat_cnt FROM chats  
    group by chats.application_id) as w on w.app_id=applications.id set applications.chats_count=w.chat_cnt
[0m
  ↳ lib/tasks/whenever_update_application_count.rake:14:in `block in <main>'
  [1m[35m (2.0ms)[0m  [1m[33m    UPDATE chats  
    JOIN (SELECT messages.chat_id as chat_id,count(messages.id) as message_cnt FROM messages 
     group by messages.chat_id) as w on w.chat_id=chats.id set chats.messages_count=w.message_cnt
[0m
  ↳ lib/tasks/whenever_update_application_count.rake:15:in `block in <main>'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:43:13 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (16.9ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (12.0ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApplications (20221031093242)
  [1m[35m (16.3ms)[0m  [1m[35mCREATE TABLE `applications` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `app_token` varchar(255) NOT NULL, `name` varchar(255), `chats_count` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `unique_token` (`app_token`))[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031093242')[0m
  [1m[36mTRANSACTION (2.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221031101600)
  [1m[35m (16.7ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `messages_count` int, `application_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_application_id` (`application_id`), CONSTRAINT `fk_rails_3b5054ba3a`
FOREIGN KEY (`application_id`)
  REFERENCES `applications` (`id`)
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031101600')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateMessages (20221031102220)
  [1m[35m (15.3ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `body` varchar(255), `chat_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_chat_id` (`chat_id`), CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031102220')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNameToChats (20221101072554)
  [1m[35m (24.1ms)[0m  [1m[35mALTER TABLE `chats` ADD `name` varchar(255)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221101072554')[0m
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-07 08:48:38.698243', '2022-11-07 08:48:38.698243')[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` ORDER BY `chats`.`id` ASC LIMIT 1000[0m
  ↳ app/models/message.rb:17:in `<class:Message>'
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007faa5e73ced0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007faa5ecf0db8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007faa5e79fe90 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007faa5e7a2708 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007faa5e79fda0 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007faa5e7a2550 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007faa5e7a2488>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007faa5e6c5b50 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007faa5ecf0db8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007faa5e79fe90 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007faa5e7a2708 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007faa5e79fda0 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007faa5e7a2550 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007faa5e7a2488>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007faa5e6dbe50 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007faa5ecf0db8>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007faa5e79fe90 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007faa5e7a2708 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007faa5e79fda0 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007faa5e7a2550 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007faa5e7a2488>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:mk4aoo][#<Thread:0x00007faa6332fc70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007faa5e6eabf8>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007faa5e6eabf8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:mk4aoo][#<Thread:0x00007faa6332fc70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007faa5e6eabf8>] New worker: I'm alive.
[worker-instabug.message.create:1:oqden4][#<Thread:0x00007faa6332fc70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007faa5e6ef0e0>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007faa5e6ef0e0>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.chat.create:1:fs5r41][#<Thread:0x00007faa6332fc70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007faa5e6e87b8>] New worker: subscribing.
[worker-instabug.message.create:1:oqden4][#<Thread:0x00007faa6332fc70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007faa5e6ef0e0>] New worker: I'm alive.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007faa5e6e87b8>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:fs5r41][#<Thread:0x00007faa6332fc70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007faa5e6e87b8>] New worker: I'm alive.
[worker-instabug.message.create:1:yltz7v][#<Thread:0x00007faa6332fc70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007faa5e6ee190>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007faa5e6ee190>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:yltz7v][#<Thread:0x00007faa6332fc70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007faa5e6ee190>] New worker: I'm alive.
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (1.5ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
  [1m[36mChat Load (0.5ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` ORDER BY `chats`.`id` ASC LIMIT 1000[0m
  ↳ app/models/message.rb:17:in `<class:Message>'
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6692ef0d08 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6693518d98>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6692fc8960 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6692fcb1b0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6692fc8870 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6692fcaff8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6692fcaf30>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6692f0c5d0 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6693518d98>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6692fc8960 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6692fcb1b0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6692fc8870 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6692fcaff8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6692fcaf30>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007f6692f15f18 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007f6693518d98>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007f6692fc8960 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007f6692fcb1b0 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007f6692fc8870 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007f6692fcaff8 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007f6692fcaf30>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:34e5qs][#<Thread:0x00007f6697b57c78 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f28f28>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6692f28f28>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:34e5qs][#<Thread:0x00007f6697b57c78 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f28f28>] New worker: I'm alive.
[worker-instabug.message.create:1:vxs7h4][#<Thread:0x00007f6697b57c78 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6692f2c240>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6692f2c240>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:vxs7h4][#<Thread:0x00007f6697b57c78 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6692f2c240>] New worker: I'm alive.
[worker-instabug.chat.create:1:lb7az7][#<Thread:0x00007f6697b57c78 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f2fc88>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6692f2fc88>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:lb7az7][#<Thread:0x00007f6697b57c78 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f2fc88>] New worker: I'm alive.
[worker-instabug.message.create:1:6wvg0j][#<Thread:0x00007f6697b57c78 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6692f32e38>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007f6692f32e38>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:6wvg0j][#<Thread:0x00007f6697b57c78 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6692f32e38>] New worker: I'm alive.
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.22.0.1 at 2022-11-07 08:51:55 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.8ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('ff0cb2e4-e6fd-410a-a3cd-7efe751893a9', 'first app', '2022-11-07 08:51:56.754331', '2022-11-07 08:51:56.754331')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 123ms (Views: 0.5ms | ActiveRecord: 7.7ms | Allocations: 12221)


Heartbeat: running threads [9]
Heartbeat: running threads [9]
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:52:07 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (1.0ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'ff0cb2e4-e6fd-410a-a3cd-7efe751893a9' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007f82be2df0a8 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82be2dcdd0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82be2dcdd0 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 216ms (Views: 0.3ms | ActiveRecord: 2.4ms | Allocations: 15707)


[worker-instabug.chat.create:1:34e5qs][#<Thread:0x00007f6693ce0b98 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f28f28>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":1,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 1, '2022-11-07 08:52:08.310396', '2022-11-07 08:52:08.310396', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (3.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Started POST "/messages" for 172.22.0.1 at 2022-11-07 08:52:15 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"first message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (0.7ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'ff0cb2e4-e6fd-410a-a3cd-7efe751893a9' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:55:in `set_chat'
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` ORDER BY `chats`.`id` ASC LIMIT 1000[0m
  ↳ app/models/message.rb:17:in `<class:Message>'
  [1m[36mMessage Load (0.7ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 1[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007f82be052150 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82be050918 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82be050918 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 141ms (Views: 1.1ms | ActiveRecord: 4.0ms | Allocations: 11778)


[worker-instabug.message.create:1:vxs7h4][#<Thread:0x00007f6693d0e430 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007f6692f2c240>] Working off: "{\"id\":null,\"number\":1,\"body\":\"first message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'first message', 1, '2022-11-07 08:52:15.935586', '2022-11-07 08:52:15.935586')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 08:52:15 +0000, interval (s): 29
Started POST "/chats" for 172.22.0.1 at 2022-11-07 08:53:08 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"second chat first app"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'ff0cb2e4-e6fd-410a-a3cd-7efe751893a9' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Allocated channel id: 3
Session#handle_frame on 3: #<AMQ::Protocol::Channel::OpenOk:0x00007f82c483f628 @channel_id="">
Session#handle_frame on 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82c483c090 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007f82c483c090 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 14ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 1637)


[worker-instabug.chat.create:1:lb7az7][#<Thread:0x00007f6693ce0288 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007f6692f2fc88>] Working off: "{\"id\":null,\"number\":2,\"messages_count\":null,\"application_id\":1,\"created_at\":null,\"updated_at\":null,\"name\":\"second chat first app\"}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.6ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (2, 1, '2022-11-07 08:53:09.062493', '2022-11-07 08:53:09.062493', 'second chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mMessage Load (0.9ms)[0m  [1m[34mSELECT `messages`.* FROM `messages` WHERE `messages`.`chat_id` = 2[0m
  ↳ app/models/concerns/searchable.rb:21:in `as_indexed_json'
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Started GET "/chats/5806bb59-0f60-457e-807f-2fd06a1558f7/1/search/first%20message" for 172.22.0.1 at 2022-11-07 08:53:56 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"}
  [1m[36mApplication Load (0.5ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = '5806bb59-0f60-457e-807f-2fd06a1558f7' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 843)


Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:53:09 +0000, interval (s): 29
Started GET "/chats/ff0cb2e4-e6fd-410a-a3cd-7efe751893a9/1/search/first%20message" for 172.22.0.1 at 2022-11-07 08:54:04 +0000
Processing by ChatsController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'ff0cb2e4-e6fd-410a-a3cd-7efe751893a9' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:70:in `set_application'
  [1m[36mChat Load (1.0ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` WHERE `chats`.`application_id` = 1 AND `chats`.`number` = 1 LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:66:in `set_chat'
[31mUnpermitted parameters: :number, :q. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f82c4541228>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"} }[0m
[31mUnpermitted parameters: :app_token, :number. Context: { controller: ChatsController, action: search, request: #<ActionDispatch::Request:0x00007f82c4541228>, params: {"controller"=>"chats", "action"=>"search", "app_token"=>"[FILTERED]", "number"=>"1", "q"=>"first message"} }[0m
Completed 200 OK in 61ms (Views: 41.3ms | ActiveRecord: 1.5ms | Allocations: 2741)


Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:53:09 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:53:09 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:53:09 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 08:53:09 +0000, interval (s): 29
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (30.2ms)[0m  [1m[35mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL PRIMARY KEY)[0m
  [1m[35m (35.2ms)[0m  [1m[35mCREATE TABLE `ar_internal_metadata` (`key` varchar(255) NOT NULL PRIMARY KEY, `value` varchar(255), `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL)[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Migrating to CreateApplications (20221031093242)
  [1m[35m (23.0ms)[0m  [1m[35mCREATE TABLE `applications` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `app_token` varchar(255) NOT NULL, `name` varchar(255), `chats_count` int, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, UNIQUE INDEX `unique_token` (`app_token`))[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.3ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031093242')[0m
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateChats (20221031101600)
  [1m[35m (29.7ms)[0m  [1m[35mCREATE TABLE `chats` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `messages_count` int, `application_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_chats_on_application_id` (`application_id`), CONSTRAINT `fk_rails_3b5054ba3a`
FOREIGN KEY (`application_id`)
  REFERENCES `applications` (`id`)
)[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031101600')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateMessages (20221031102220)
  [1m[35m (41.7ms)[0m  [1m[35mCREATE TABLE `messages` (`id` bigint NOT NULL AUTO_INCREMENT PRIMARY KEY, `number` int, `body` varchar(255), `chat_id` bigint NOT NULL, `created_at` datetime(6) NOT NULL, `updated_at` datetime(6) NOT NULL, INDEX `index_messages_on_chat_id` (`chat_id`), CONSTRAINT `fk_rails_0f670de7ba`
FOREIGN KEY (`chat_id`)
  REFERENCES `chats` (`id`)
)[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.5ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221031102220')[0m
  [1m[36mTRANSACTION (3.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddNameToChats (20221101072554)
  [1m[35m (48.5ms)[0m  [1m[35mALTER TABLE `chats` ADD `name` varchar(255)[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO `schema_migrations` (`version`) VALUES ('20221101072554')[0m
  [1m[36mTRANSACTION (23.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO `ar_internal_metadata` (`key`, `value`, `created_at`, `updated_at`) VALUES ('environment', 'development', '2022-11-07 09:11:38.623872', '2022-11-07 09:11:38.623872')[0m
  [1m[36mTRANSACTION (48.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (2.1ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE `chatDB` DEFAULT CHARACTER SET `utf8mb4`[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block in execute at /usr/local/lib/ruby/gems/3.1.0/gems/rake-13.0.6/lib/rake/task.rb:281)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT GET_LOCK('2558702519155103580', 0)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT `ar_internal_metadata`.* FROM `ar_internal_metadata` WHERE `ar_internal_metadata`.`key` = 'environment' LIMIT 1[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT RELEASE_LOCK('2558702519155103580')[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <main> at /app/app/models/application_record.rb:1)
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fcd65b490f8 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fcd660a4d68>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fcd65b544a8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fcd65b56cf8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fcd65b543b8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fcd65b56b40 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fcd65b56a78>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fcd65b5ee08 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fcd660a4d68>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fcd65b544a8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fcd65b56cf8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fcd65b543b8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fcd65b56b40 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fcd65b56a78>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
Loading runner configuration...
New configuration: #<Sneakers::Configuration:0x00007fcd65b6a988 @hash={:error_reporters=>[#<Sneakers::ErrorReporter::DefaultLogger:0x00007fcd660a4d68>], :runner_config_file=>nil, :metrics=>nil, :daemonize=>true, :start_worker_delay=>0.2, :workers=>2, :log=>#<IO:<STDOUT>>, :pid_path=>"tmp/pids/sneakers.pid", :amqp_heartbeat=>30, :prefetch=>1, :threads=>2, :share_threads=>false, :ack=>true, :hooks=>{}, :exchange=>"sneakers", :exchange_options=>{:type=>:direct, :durable=>true, :auto_delete=>false, :arguments=>{}}, :queue_options=>{:durable=>true, :auto_delete=>false, :exclusive=>false, :arguments=>{}}, :connection=>#<Bunny::Session:0x4ba0 guest@rabbitmq:5672, vhost=/, addresses=[rabbitmq:5672]>, :handler=>Sneakers::Handlers::Maxretry, :retry_max_times=>10, :retry_timeout=>180000, :logger=>#<ActiveSupport::Logger:0x00007fcd65b544a8 @level=0, @progname=nil, @default_formatter=#<Logger::Formatter:0x00007fcd65b56cf8 @datetime_format=nil>, @formatter=#<ActiveSupport::Logger::SimpleFormatter:0x00007fcd65b543b8 @datetime_format=nil, @thread_key="activesupport_tagged_logging_tags:11180">, @logdev=#<Logger::LogDevice:0x00007fcd65b56b40 @shift_period_suffix="%Y%m%d", @shift_size=1048576, @shift_age=0, @filename="/app/log/development.log", @dev=#<File:/app/log/development.log>, @binmode=false, @mon_data=#<Monitor:0x00007fcd65b56a78>, @mon_data_owner_object_id=4440>>, :log_level=>0, :worker_type=>"process", :worker_classes=>[ChatCreateWorker, MessageCreateWorker], :log_stdout=>false, :log_stderr=>false}>
[worker-instabug.chat.create:1:wqyxy8][#<Thread:0x00007fcd6a6e3c70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fcd65d03b78>] New worker: subscribing.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fcd65d03b78>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:wqyxy8][#<Thread:0x00007fcd6a6e3c70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fcd65d03b78>] New worker: I'm alive.
[worker-instabug.message.create:1:8c3al7][#<Thread:0x00007fcd6a6e3c70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65d040c8>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fcd65d040c8>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.chat.create:1:89y3ka][#<Thread:0x00007fcd6a6e3c70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fcd65d00c20>] New worker: subscribing.
[worker-instabug.message.create:1:8c3al7][#<Thread:0x00007fcd6a6e3c70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65d040c8>] New worker: I'm alive.
Maxretry handler [queue=instabug.chat.create] creating handler, opts=#<Sneakers::Configuration:0x00007fcd65d00c20>
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-error
Maxretry handler [queue=instabug.chat.create] creating exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-retry x-dead-letter-exchange=instabug.chat.create-retry-requeue
Maxretry handler [queue=instabug.chat.create] creating queue=instabug.chat.create-error
[worker-instabug.chat.create:1:89y3ka][#<Thread:0x00007fcd6a6e3c70 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fcd65d00c20>] New worker: I'm alive.
[worker-instabug.message.create:1:5udwaj][#<Thread:0x00007fcd6a6e3c70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65b02f90>] New worker: subscribing.
Maxretry handler [queue=instabug.message.create] creating handler, opts=#<Sneakers::Configuration:0x00007fcd65b02f90>
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-error
Maxretry handler [queue=instabug.message.create] creating exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-retry x-dead-letter-exchange=instabug.message.create-retry-requeue
Maxretry handler [queue=instabug.message.create] creating queue=instabug.message.create-error
[worker-instabug.message.create:1:5udwaj][#<Thread:0x00007fcd6a6e3c70 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65b02f90>] New worker: I'm alive.
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
Heartbeat: running threads [9]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from block (2 levels) in <class:Railtie> at /usr/local/bundle/gems/activerecord-7.0.4/lib/active_record/railtie.rb:264)
Started POST "/applications" for 172.23.0.1 at 2022-11-07 09:33:32 +0000
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC[0m
Processing by ApplicationsController#create as */*
  Parameters: {"name"=>"first app"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mApplication Create (0.9ms)[0m  [1m[32mINSERT INTO `applications` (`app_token`, `name`, `created_at`, `updated_at`) VALUES ('b7051eae-98a7-4e09-846d-04d01d0b4166', 'first app', '2022-11-07 09:33:34.473593', '2022-11-07 09:33:34.473593')[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/applications_controller.rb:13:in `create'
Completed 201 Created in 196ms (Views: 0.4ms | ActiveRecord: 5.9ms | Allocations: 12225)


Started POST "/chats" for 172.23.0.1 at 2022-11-07 09:33:50 +0000
Processing by ChatsController#create as */*
  Parameters: {"app_token"=>"[FILTERED]", "name"=>"first chat first app"}
  [1m[36mApplication Load (0.6ms)[0m  [1m[34mSELECT `applications`.* FROM `applications` WHERE `applications`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' LIMIT 1[0m
  ↳ app/controllers/chats_controller.rb:62:in `set_application'
Sent protocol preamble
Sent connection.start-ok
Heartbeat interval negotiation: client = server, server = 60, result = 60
Heartbeat interval used (in seconds): 60
Will use socket read timeout of 132 seconds
Initializing channel ID allocator with channel_max = 2047
Sent connection.tune-ok with heartbeat interval = 60, frame_max = 131072, channel_max = 2047
Sent connection.open with vhost = /
Initializing heartbeat sender...
Allocated channel id: 1
Session#handle_frame on 1: #<AMQ::Protocol::Channel::OpenOk:0x00007fd85006bc58 @channel_id="">
Session#handle_frame on 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd850069c00 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 1: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd850069c00 @queue="instabug.chat.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 250ms (Views: 0.3ms | ActiveRecord: 2.1ms | Allocations: 10814)


[worker-instabug.chat.create:1:wqyxy8][#<Thread:0x00007fcd65ad0310 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.chat.create][#<Sneakers::Configuration:0x00007fcd65d03b78>] Working off: "{\"id\":null,\"number\":1,\"messages_count\":null,\"application_id\":1,\"created_at\":null,\"updated_at\":null,\"name\":\"first chat first app\"}"
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mChat Create (0.8ms)[0m  [1m[32mINSERT INTO `chats` (`number`, `application_id`, `created_at`, `updated_at`, `name`) VALUES (1, 1, '2022-11-07 09:33:50.725428', '2022-11-07 09:33:50.725428', 'first chat first app')[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/chat_create_worker.rb:14:in `work'
Heartbeat: running threads [11]
Heartbeat: running threads [9]
Started POST "/messages" for 172.23.0.1 at 2022-11-07 09:33:58 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"first message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.2ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:62:in `set_chat'
Allocated channel id: 2
Session#handle_frame on 2: #<AMQ::Protocol::Channel::OpenOk:0x00007fd82b2d02e8 @channel_id="">
Session#handle_frame on 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd82b2cea88 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 2: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd82b2cea88 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 254ms (Views: 0.4ms | ActiveRecord: 3.0ms | Allocations: 12455)


[worker-instabug.message.create:1:8c3al7][#<Thread:0x00007fcd65af5728 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65d040c8>] Working off: "{\"id\":null,\"number\":1,\"body\":\"first message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (1.0ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (1, 'first message', 1, '2022-11-07 09:33:59.436709', '2022-11-07 09:33:59.436709')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Started GET "/chats/b7051eae-98a7-4e09-846d-04d01d0b4166/1/search/first%20message" for 172.23.0.1 at 2022-11-07 09:34:10 +0000
  
ActionController::RoutingError (No route matches [GET] "/chats/b7051eae-98a7-4e09-846d-04d01d0b4166/1/search/first%20message"):
  
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 09:33:59 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 09:33:59 +0000, interval (s): 29
Started GET "/messages/b7051eae-98a7-4e09-846d-04d01d0b4166/1/search/first%20message" for 172.23.0.1 at 2022-11-07 09:35:20 +0000
Processing by MessagesController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:62:in `set_chat'
[31mUnpermitted parameter: :q. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd82b1cc180>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
[31mUnpermitted parameters: :app_token, :chat_number. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd82b1cc180>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
Completed 200 OK in 240ms (Views: 50.5ms | ActiveRecord: 4.5ms | Allocations: 10860)


Heartbeat: running threads [12]
Heartbeat: running threads [9]
Sending a heartbeat, last activity time: 2022-11-07 09:33:59 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [9]
Started POST "/messages" for 172.23.0.1 at 2022-11-07 09:36:01 +0000
Processing by MessagesController#create as */*
  Parameters: {"body"=>"second message", "chat_number"=>"1", "app_token"=>"[FILTERED]"}
  [1m[36mChat Load (1.1ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:62:in `set_chat'
Allocated channel id: 3
Session#handle_frame on 3: #<AMQ::Protocol::Channel::OpenOk:0x00007fd852314930 @channel_id="">
Session#handle_frame on 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd8522e1828 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Channel#handle_frame on channel 3: #<AMQ::Protocol::Queue::DeclareOk:0x00007fd8522e1828 @queue="instabug.message.create", @message_count=0, @consumer_count=2>
Completed 201 Created in 139ms (Views: 0.3ms | ActiveRecord: 1.8ms | Allocations: 5010)


[worker-instabug.message.create:1:5udwaj][#<Thread:0x00007fcd65af4580 /usr/local/bundle/gems/bunny-2.19.0/lib/bunny/consumer_work_pool.rb:101 run>][instabug.message.create][#<Sneakers::Configuration:0x00007fcd65b02f90>] Working off: "{\"id\":null,\"number\":2,\"body\":\"second message\",\"chat_id\":1,\"created_at\":null,\"updated_at\":null}"
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO `messages` (`number`, `body`, `chat_id`, `created_at`, `updated_at`) VALUES (2, 'second message', 1, '2022-11-07 09:36:02.417062', '2022-11-07 09:36:02.417062')[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/workers/message_create_worker.rb:14:in `work'
Started GET "/messages/b7051eae-98a7-4e09-846d-04d01d0b4166/1/search/first%20message" for 172.23.0.1 at 2022-11-07 09:36:05 +0000
Processing by MessagesController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"}
  [1m[36mChat Load (0.8ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:62:in `set_chat'
[31mUnpermitted parameter: :q. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd8522fbc78>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
[31mUnpermitted parameters: :app_token, :chat_number. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd8522fbc78>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
Completed 200 OK in 52ms (Views: 45.7ms | ActiveRecord: 0.8ms | Allocations: 2445)


Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Started GET "/messages/b7051eae-98a7-4e09-846d-04d01d0b4166/1/search/first%20message" for 172.23.0.1 at 2022-11-07 09:38:44 +0000
Processing by MessagesController#search as */*
  Parameters: {"app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"}
  [1m[36mChat Load (0.4ms)[0m  [1m[34mSELECT `chats`.* FROM `chats` INNER JOIN `applications` `application` ON `application`.`id` = `chats`.`application_id` WHERE `application`.`app_token` = 'b7051eae-98a7-4e09-846d-04d01d0b4166' AND `chats`.`number` = 1 ORDER BY `chats`.`id` ASC LIMIT 1[0m
  ↳ app/controllers/messages_controller.rb:62:in `set_chat'
[31mUnpermitted parameter: :q. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd852185768>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
[31mUnpermitted parameters: :app_token, :chat_number. Context: { controller: MessagesController, action: search, request: #<ActionDispatch::Request:0x00007fd852185768>, params: {"controller"=>"messages", "action"=>"search", "app_token"=>"[FILTERED]", "chat_number"=>"1", "q"=>"first message"} }[0m
Completed 200 OK in 203ms (Views: 16.3ms | ActiveRecord: 4.4ms | Allocations: 10927)


Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
Sending a heartbeat, last activity time: 2022-11-07 09:36:02 +0000, interval (s): 29
Heartbeat: running threads [12]
Heartbeat: running threads [11]
